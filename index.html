<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Ng3ArExamples</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <style>
    .slider {
      /* position: absolute; */
      /* bottom: 40px; */
      /* left: 40px; */
      /* margin: 0 auto; */
      /* padding: 0 auto; */
      margin-top: 50px;
      margin-bottom: 50px;
      /* display: flex; */
      /* flex-direction: row; */
      /* width: 100vw; */
    }

    .slides {
      display: flex;
      justify-content: center;
    }

    .slide {
      scroll-snap-align: start;
      flex-shrink: 0;
      width: 100px;
      height: 100px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      background-color: coral;
      margin-right: 10px;
      border-radius: 10px;
      border: none;
      display: flex;
      font-size: 20px;
      font-weight: 600;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>

<body>
  <!-- Import the component -->
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>

  <div style="position: relative;">

    <!-- Use it like any other HTML element -->
    <model-viewer id="myModel" style="width: 100vw; height: 100vh;"
      alt="Neil Armstrong's Spacesuit from the Smithsonian Digitization Programs Office and National Air and Space Museum"
      touch-action="pan-y" src="./nissan_navara_2021_calibre_e.glb" ar ar-tracking="tracking" disable-tap
      ar-modes="scene-viewer quick-look" poster="./favicon.ico" camera-controls
      shadow-intensity="5"></model-viewer>
    <div class="slider">
      <div class="slides">
        <button class="slide selected"
          onclick="switchSrc(this, 'https://first-free-bucket-hnpanchal.s3.amazonaws.com/modified_nissan_4x4.glb')">
          Nissan 4x4
        </button><button class="slide"
          onclick="switchSrc(this, 'https://first-free-bucket-hnpanchal.s3.amazonaws.com/Chair.glb')">
          Chair
        </button><button class="slide"
          onclick="switchSrc(this, 'https://first-free-bucket-hnpanchal.s3.amazonaws.com/post-apocalyptic_vehicle.glb')">
          Buggy
        </button><button class="slide"
          onclick="switchSrc(this, 'https://first-free-bucket-hnpanchal.s3.amazonaws.com/nissan_navara_2021_calibre_e.glb')">
          Nissan Puckup
        </button>
      </div>
    </div>
  </div>

  <!-- ar-modes="scene-viewer quick-look"
  skybox-image="./assets/spruit_sunrise_1k_HDR.jpg" skybox-height="0.5m"
  max-camera-orbit="auto 90deg auto" -->

 <script>
        // Target GPS coordinates (where the model will be shown)
        const targetLatitude = 23.028673;  // Replace with your target latitude
        const targetLongitude = 72.528757; // Replace with your target longitude
        const maxDistance = 0.1; // Maximum distance in kilometers

        // Watch for changes in the user's location
        const watchId = navigator.geolocation.watchPosition((position) => {
            const userLatitude = position.coords.latitude;
            const userLongitude = position.coords.longitude;

            // Calculate the distance between user's location and target location
            const distance = calculateDistance(userLatitude, userLongitude, targetLatitude, targetLongitude);

            // Show or hide the model based on the distance
            const modelElement = document.getElementById('myModel');
            if (distance <= maxDistance) {
                modelElement.style.display = 'block'; // Show the model if within 100 km
                positionModelElement(modelElement);
            } else {
                modelElement.style.display = 'none'; // Hide the model if outside 100 km
            }
        }, (error) => {
            console.error("Error getting location:", error);
        }, {
            enableHighAccuracy: true, // Enable high-accuracy mode
            maximumAge: 0,            // Don't use cached location
            timeout: 5000             // Timeout after 5 seconds
        });

        // Function to calculate the distance between two lat/lon points using the Haversine formula
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the Earth in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c; // Distance in km
            return distance;
        }

        // Function to position the model (for demonstration purposes)
        function positionModelElement(element) {
            element.style.top = `${window.innerHeight / 2}px`; // Vertical center
            element.style.left = `${window.innerWidth / 2}px`;  // Horizontal center
        }
    </script>
  <!-- <app-root></app-root> -->
</body>

</html>
